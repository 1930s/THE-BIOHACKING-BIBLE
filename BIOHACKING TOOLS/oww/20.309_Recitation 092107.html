<div style="padding: 10px; width: 774px; border: 3px solid #000000;">

<center><big>'''20.309 Fall Semester 2007'''</big></center>
<center><big>Recitation Notes for 9/21/2007'''</big></center>
<br/>

==Review of ideal circuit elements==

===Linear passive===
{|border="2px" fontsize="14" cellpadding="7px" style="margin: 1em auto 1em auto"
|-
!Element
!Symbol
!Equation
!Comments
|-
|Resistor
|[[Image:Resistor Symbol.jpg]]
|<math>\frac{V}{I}=R</math>
|
*constant, real impedance <math>R</math>
*only element that dissipates power
|-
|Inductor
|[[Image:Inductor Symbol.jpg]]
|<math>\frac{V}{I}=L i \omega</math>
|
*impedance is imaginary 
*magnitude increases linearly with frequency
|-
|Capacitor
|[[Image:Capacitor Symbol.jpg]]
|<math>\frac{V}{I}=\frac{1}{C i \omega}</math>
|
*impedance is imaginary
*magnitude decreases as 1/&omega;
|}

===Independent sources===
{|border="2px" fontsize="14"  cellpadding="7px" style="margin: 1em auto 1em auto"
|-
!Element
!Symbol
!Equation
!Comments
|-
|Voltage Source
|[[Image:Voltage Source Symbol.jpg]]
|<math>V=constant</math>
|
*constant output voltage regardless of load
*zero output impedance
|-
|Current Source
|[[Image:Current Source Symbol.jpg]]
|<math>I=constant</math>
|
*constant output current regardless of load
*infinite output impedance
|}

===Dependent sources===
{|border="2px" fontsize="14"  cellpadding="7px" style="margin: 1em auto 1em auto"
|-
!Element
!Symbol
!Equation
!Comments
|-
|Op Amp
|[[Image:Op Amp Symbol.jpg]]
|<math>V_o=A(V_+ - V_-)</math>
|
*<math>A\rightarrow\infty</math>
*infinite input impedance
*zero output impedance
|}

==Modeling real components==

*The ideal elements comprise a vocabulary of mathematical relationships that are useful for modeling real systems.
*In many situations, a single ideal element models the behavior of a real component well.
*At other times, such as high frequency, high load, or high gain, it may be necessary to create a more sophisticated model

===Example: modeling a battery===
Consider models for common AAA and D cell batteries.

<center>
[[Image:AAA and D cell.jpg|200 px]]

'''AAA and D cell'''
</center>

===Simple model: ideal voltage source===
*The voltage output of both the AAA and the D cell is 1.6 V
*A simple model for both batteries is a voltage source with a value of 1.6V
*This model works well with small loads
*This model does not capture any difference between the two sizes

<center>
[[Image:Simple Battery Model.jpg]]

'''Simple Battery Model'''
</center>

===Measuring output resistance===

*Output resistance can be estimated from open circuit voltage and short circuit current.

{|border="2px" fontsize="14" cellpadding="7px" style="margin: 1em auto 1em auto"
|-
!
!AAA
!D
|-
!Measured open circuit voltage (''V<sub>oc</sub>''),
|1.6 V
|1.6 V
|-
!Measured short circuit current (''I<sub>sc</sub>)
|5.4 A
|11.8 A
|-
!Computed output resistance
|0.30 &Omega;
|0.14 &Omega;
|}

===Better model: output resistance===
*Output resistance is simply add in series with the voltage source.

<center>
[[Image:Battery Model With Output Resistance.jpg]]

'''Battery Model including Output Resistance'''
</center>

===Comparing the two models under heavy loading (0.2 &Omega;)===
{|border="2px" fontsize="14" cellpadding="7px" style="margin: 1em auto 1em auto"
|-
!
!AAA
!D
|-
!Battery Voltage Under 0.2 &Omega; Load Predicted by Simple Model
|1.6 V
|1.6 V
|-
!Battery Voltage Under 0.2 &Omega; Load Predicted by Output Resistance Model
|0.9 V
|1.2 V
|-
!Measured Battery Voltage Under 0.2 &Omega; Load
|0.9 V
|1.1 V
|}

<br/>

*The improved model predicts the output voltage and current flow under a load of 0.2 Ohms
*This model is much more accurate under heavy load conditions.

===Op amp model===

*Just as with the battery, it is possible to make a more accurate op amp model by adding elements
*Offset voltage, input bias current, input offset current can be modeled by adding simple souces to the ideal op amp
*Unfortunately, these parameters are temperature dependent
*Non-infinite gain and frequency dependence can be modeled by cascading a transfer function at the output of the op amp
*Regardless of the connection, the product of gain and bandwidth is constant. This parameter is usually specified in the datasheet.
<br/>

<center>
[[Image:Op Amp Model.jpg]]
</center>

==Sallen Key circuit==

===Key concepts===

*Even though the circuit is complicated, solving it requires only two techniques: the golden rules and Kirchoff' Current Law.
*Because of the buffer amplifer at its output, the Sallen Key circuit has low output impedence.
*The circuit implements a ''second order'' low pass filter. (There are also band and high pass versions.)
*The cutoff frequency, &omega;<sub>c</sub>, occurs where the magnitude of the transfer funcion falls to <math>1/\sqrt{2}</math>. 
*Above the cutoff frequency, the second order transfer function falls off twice as fast as the first order &mdash; 40 dB per decade versus 20.

===Approach to solving the Sallen Key circuit===

#Apply the Golden Rules
#Apply KCL at the <math>V_x</math> node
#Apply KCL at the <math>V_-</math> node
#Solve one equation for <math>V_x</math> and substitute into the other
#Rewrite the result in the form of a transfer function <math>V_o / V_i</math>

''ALthough the details are different, the same approach will work to solve the op amp question on Homework #1''

===The gruesome details===

====Apply the Golden Rules====

In the Sallen Key circuit, a wire connects <math>V_-</math> to <math>V_o</math>. Therefore, <math>V_- = V_+ = V_o</math>. This will be a useful substitution when applying KCL. 

====Apply KCL at the <math>V_x</math> node====

=====KCL=====
:<math>
\frac{V_i-V_x}{R_1} + \frac{V_o-V_x}{R_2} + C_1 s (V_o - V_x) = 0 
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<big>(1)</big>
<br/>

=====Multiply by <math>R_1 R_2</math>=====
:<big><math>
R_2(V_i-V_x) + R_1(V_o-V_x) + R_1 R_2 C_1 s (V_o - V_x) = 0
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)</big>
<br/>

=====Gather terms=====
:<big><math>
R_2 V_i - (R_2 + R_1 + R_1 R_2 C_1 s) V_x + (R_1 + R_1 R_2 C_1 s)V_o = 0
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)</big>
<br/>

====Apply KCL at the <math>V_-</math> node====

=====KCL=====
:<math>
\frac{V_x-V_o}{R_2} - V_o C_2 s = 0
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<big>(4)</big>
<br/>

=====Multiply by <math>R_2</math>=====
:<big><math>
V_x=V_o (1 + R_2 C_2 s)
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)</big>
<br/>

====Substitute for <math>V_x</math> (equation 5 into equation 3)====

=====Sustitute=====
:<big><math>
R_2 V_i - (R_2 + R_1 + R_1 R_2 C_1 s) (1 + R_2 C_2 s) V_o  + (R_1 + R_1 R_2 C_1 s)V_o = 0
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(6)</big>
<br/>

=====Multiply and collect terms=====
:<big><math>
R_2 V_i + (-R_2 -R_1 - R_1 R_2 C_1 s - R_2^2 C_2 s - R_1 R_2 C_2 s - R_1 R_2^2 C_1 C_2 s^2 + R_1 + R_1 R_2 C_1 s)V_o = 0
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(7)</big>
<br/>

:<big><math>
V_i = \{ R_1 R_2 C_1 C_2 s^2 + C_2(R_1 + R_2) s + 1\}V_o
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8)</big>
<br/>

====Rewrite as a transfer function====
:<math>
\frac{V_o}{V_i} = \frac{1}{ R_1 R_2 C_1 C_2 s^2 + C_2(R_1 + R_2) s + 1}
</math>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<big>(9)</big>
<br/>

===Comparison of first and second order transfer functions===

Compare the Sallen Key transfer function with the first order low pass filter we considered in class:

:<math>
\frac{V_o}{V_i} = \frac{1}{ R C s + 1}
</math>
<br/>

Because its transfer function includes an <math>s^2</math> term, the Sallen Key filter is called a second order filter. The magnitude of both functions is plotted below. Although they have similar cutoff frequencies, the Sallen Key function falls off twice as fast as the passive RC filter (40 dB/decade versus 20 dB/decade).

[[Image:First Order vs Second Order Low Pass.jpg|700 px|center]]

Here is the Matlab code that generated the plot:

<pre>
%Clear the plot axes
clf;

%Component values for Sallen Key circuit (gives Fc = 1)
R1=1;
R2=1;
C1=1;
C2=1;

%Generate a vector for the frequency axis with exponential spacing
w = -2:.01:2;
w = 10 .^ w;
s = Fc * w * j;

% Sallen Key transfer function
Vsk = 1 ./ (R1 * R2 * C1 * C2 * s .^2 + (R1 + R2) * C2 * s + 1);

%Plot the magnitude of the transfer function on a log-log scale vs.
%frequency
loglog( abs(s), abs(Vsk), 'b', 'LineWidth', 3);

%Maintain the current plot
hold on

%Adjust axes for a little headroom around the plot
axis([ min(abs(s)), max(abs(s)), 1.2 * min(abs(Vsk)), 1.2 * max(abs(Vsk))])

%Component values for 1st order circuit
R = 1;
C = 1;

% Single order low pass transfer function
Vlp = 1 ./(R * C * s + 1);

%Plot the magnitude of the transfer function on athe same axes
loglog(abs(s), abs(Vlp), 'r', 'LineWidth', 3);

%Add a chart title, legend, and axis labels
title('First and Second Order Filter Responses', 'FontSize', 18)
legend('Second Order', 'First Order', 'Location', 'SouthWest');
ylabel('|H(s)|', 'FontSize', 14);
xlabel('Frequency', 'FontSize', 14);</pre>

</div>